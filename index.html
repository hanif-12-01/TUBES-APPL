<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Lapor Mangan! - Aplikasi pencarian kuliner UMKM di Purwokerto. Temukan makanan terbaik di sekitarmu!">
    <meta name="theme-color" content="#FF6B35">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Lapor Mangan!">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    
    <title>Lapor Mangan! - Purwokerto</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icons & Maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Splash Screen - HIDDEN by default -->
    <div id="splashScreen" class="splash-screen" style="display:none!important;">
        <div class="splash-content">
            <div class="splash-logo">üçΩÔ∏è</div>
            <h1>Lapor Mangan!</h1>
            <p>Temukan Kuliner Terbaik di Purwokerto</p>
            <div class="splash-loader"></div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app" class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="menu-btn" onclick="toggleSidebar()" aria-label="Menu">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo">
                    <span class="logo-icon">üçΩÔ∏è</span>
                    <div class="logo-text">
                        <h1>Lapor Mangan!</h1>
                        <span class="logo-subtitle">Purwokerto</span>
                    </div>
                </div>
            </div>
            
            <div class="header-right">
                <!-- Weather Widget -->
                <div class="weather-widget" id="weatherWidget" onclick="toggleWeatherDetails()">
                    <i class="fas fa-cloud-sun weather-icon" id="weatherIcon"></i>
                    <span class="weather-temp" id="weatherTemp">--¬∞C</span>
                    <i class="fas fa-chevron-down weather-arrow" id="weatherArrow"></i>
                </div>
                
                <!-- User Auth -->
                <div class="user-auth" id="userAuth">
                    <button class="auth-btn" onclick="toggleAuthModal()" id="loginBtn">
                        <i class="fas fa-user"></i>
                        <span>Masuk</span>
                    </button>
                    <div class="user-profile" id="userProfile" style="display: none;">
                        <img src="" alt="User" id="userAvatar" class="user-avatar">
                        <div class="user-dropdown" id="userDropdown">
                            <span id="userName">User</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                    </div>
                </div>
                
                <!-- Add Kuliner Button -->
                <button class="add-btn" onclick="openAddKulinerModal()" aria-label="Tambah Kuliner">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </header>

        <!-- Weather Details Dropdown -->
        <div class="weather-details" id="weatherDetails">
            <div class="weather-details-header">
                <h3><i class="fas fa-cloud-sun" id="weatherDetailsIcon"></i> Cuaca Purwokerto</h3>
                <button class="close-weather" onclick="toggleWeatherDetails()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="weather-date" id="weatherDate">Hari ini</div>
            <div class="weather-details-main">
                <div class="weather-big-icon">
                    <i class="fas fa-cloud-sun" id="weatherBigIcon"></i>
                </div>
                <div class="weather-info">
                    <div class="weather-temp-large" id="weatherDetailsTemp">--¬∞C</div>
                    <div class="weather-desc" id="weatherDetailsDesc">--</div>
                </div>
            </div>
            <div class="weather-stats">
                <div class="weather-stat">
                    <div class="stat-icon"><i class="fas fa-temperature-low"></i></div>
                    <div class="stat-info">
                        <span class="stat-label">Suhu Min</span>
                        <span class="stat-value" id="weatherMinTemp">--¬∞C</span>
                    </div>
                </div>
                <div class="weather-stat">
                    <div class="stat-icon"><i class="fas fa-temperature-high"></i></div>
                    <div class="stat-info">
                        <span class="stat-label">Suhu Max</span>
                        <span class="stat-value" id="weatherMaxTemp">--¬∞C</span>
                    </div>
                </div>
                <div class="weather-stat">
                    <div class="stat-icon"><i class="fas fa-tint"></i></div>
                    <div class="stat-info">
                        <span class="stat-label">Kelembapan</span>
                        <span class="stat-value" id="weatherHumidity">--%</span>
                    </div>
                </div>
                <div class="weather-stat">
                    <div class="stat-icon"><i class="fas fa-wind"></i></div>
                    <div class="stat-info">
                        <span class="stat-label">Angin</span>
                        <span class="stat-value" id="weatherWind">-- m/s</span>
                    </div>
                </div>
                <div class="weather-stat">
                    <div class="stat-icon sunrise"><i class="fas fa-sun"></i></div>
                    <div class="stat-info">
                        <span class="stat-label">Terbit</span>
                        <span class="stat-value" id="weatherSunrise">--:--</span>
                    </div>
                </div>
                <div class="weather-stat">
                    <div class="stat-icon sunset"><i class="fas fa-moon"></i></div>
                    <div class="stat-info">
                        <span class="stat-label">Terbenam</span>
                        <span class="stat-value" id="weatherSunset">--:--</span>
                    </div>
                </div>
            </div>
            <div class="weather-recommendation">
                <button class="weather-rec-btn" onclick="showWeatherRec()">
                    <i class="fas fa-utensils"></i> Rekomendasi Kuliner Sesuai Cuaca
                </button>
            </div>
            <div id="weatherCondition" style="display:none;"></div>
        </div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <span class="logo-icon">üçΩÔ∏è</span>
                <h2>Menu</h2>
                <button class="close-sidebar" onclick="toggleSidebar()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="showSection('home')">
                    <i class="fas fa-home"></i>
                    <span>Beranda</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('explore')">
                    <i class="fas fa-compass"></i>
                    <span>Jelajahi</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('favorites')">
                    <i class="fas fa-heart"></i>
                    <span>Favorit</span>
                </a>
                <a href="#/news" class="nav-item" onclick="navigateToHash('/news');return false;">
                    <i class="fas fa-newspaper"></i>
                    <span>Berita & Promo</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('map')">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>Peta</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <div class="app-version">v1.0.0</div>
            </div>
        </aside>
        
        <!-- Sidebar Overlay -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Map Section -->
            <section class="map-section">
                <div id="map"></div>
                <button class="map-locate-btn" onclick="locateUser()" aria-label="Lokasi Saya">
                    <i class="fas fa-crosshairs"></i>
                </button>
            </section>

            <!-- Search & Filter Section -->
            <section class="search-section">
                <div class="search-container">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="search" placeholder="Cari kuliner favorit..." aria-label="Cari kuliner">
                        <!-- voice search button removed -->
                    </div>
                </div>
                
                <!-- Quick Filter Chips -->
                <div class="filter-chips">
                    <button class="chip active" data-filter="all" onclick="quickFilter('all')">
                        <i class="fas fa-utensils"></i> Semua
                    </button>
                    <button class="chip" data-filter="nearby" onclick="sortByDistance()">
                        <i class="fas fa-location-arrow"></i> Terdekat
                    </button>
                    <button class="chip" data-filter="open" onclick="filterOpenNow()">
                        <i class="fas fa-clock"></i> Buka Sekarang
                    </button>
                    <button class="chip" data-filter="random" onclick="showRandomKuliner()">
                        <i class="fas fa-random"></i> Acak
                    </button>
                    <button class="chip weather-chip" data-filter="weather" onclick="showWeatherRec()">
                        <i class="fas fa-cloud-sun"></i> Cuaca
                    </button>
                </div>

                <!-- Advanced Filters -->
                <div class="filter-bar">
                    <div class="filter-group">
                        <select id="filter" aria-label="Filter Kategori">
                            <option value="">üè∑Ô∏è Semua Kategori</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <select id="filterTipe" aria-label="Filter Tipe">
                            <option value="">üè™ Semua Tipe</option>
                            <option value="tetap">üè† Warung Tetap</option>
                            <option value="keliling">üöö Pedagang Keliling</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <select id="filterHalal" aria-label="Filter Kehalalan">
                            <option value="">‚ò™Ô∏è Semua Status</option>
                            <option value="halal">‚úÖ Halal MUI</option>
                            <option value="halal-self">üïå Halal (Self-Declared)</option>
                            <option value="unknown">‚ùì Belum Diketahui</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <select id="sort" aria-label="Urutkan">
                            <option value="">üìä Urutkan</option>
                            <option value="nama">üî§ Nama A-Z</option>
                            <option value="rating">‚≠ê Rating Tertinggi</option>
                            <option value="harga-asc">üí∞ Harga Terendah</option>
                            <option value="harga-desc">üíé Harga Tertinggi</option>
                        </select>
                    </div>
                </div>
                
                <!-- Toggle Filters -->
                <div class="toggle-filters">
                    <label class="toggle-filter">
                        <input type="checkbox" id="openNowFilter">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">Hanya tampilkan yang buka</span>
                    </label>
                </div>
            </section>

            <!-- Kuliner List Section -->
            <section class="list-section">
                <div class="section-header">
                    <h2>Kuliner Populer</h2>
                    <span class="result-count" id="resultCount">0 hasil</span>
                </div>
                <div id="list" class="kuliner-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Memuat daftar kuliner...</p>
                    </div>
                </div>
            </section>

            <!-- News & Promo Section (Hidden by default) -->
            <section class="news-section" id="newsSection" style="display: none;">
                <div class="section-header">
                    <h2><i class="fas fa-newspaper"></i> Berita & Promo</h2>
                </div>
                <div id="newsList" class="news-list">
                    <!-- News items will be rendered here -->
                </div>
            </section>

            <!-- Favorites Section (Hidden by default) -->
            <section class="favorites-section" id="favoritesSection" style="display: none;">
                <div class="section-header">
                    <h2><i class="fas fa-heart"></i> Kuliner Favorit</h2>
                </div>
                <div id="favoritesList" class="kuliner-list">
                    <!-- Favorites will be rendered here -->
                </div>
            </section>
        </main>

        <!-- Detail Popup -->
        <div class="modal detail-modal" id="detailPopup">
            <div class="modal-content detail-content">
                <button class="modal-close" onclick="closeDetail()" aria-label="Tutup">
                    <i class="fas fa-times"></i>
                </button>
                <div id="detailContent"></div>
            </div>
        </div>

        <!-- Add Kuliner Modal -->
        <div class="modal" id="addKulinerModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-plus-circle"></i> Tambah Kuliner Baru</h2>
                    <button class="modal-close" onclick="closeAddKulinerModal()" aria-label="Tutup">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="addKulinerForm" class="form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="add-nama"><i class="fas fa-store"></i> Nama Kuliner *</label>
                                <input type="text" id="add-nama" placeholder="Contoh: Soto Sokaraja" required>
                            </div>
                            <div class="form-group">
                                <label for="add-kategori"><i class="fas fa-tag"></i> Kategori *</label>
                                <select id="add-kategori" required>
                                    <option value="">Pilih Kategori</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="add-alamat"><i class="fas fa-map-marker-alt"></i> Alamat *</label>
                            <input type="text" id="add-alamat" placeholder="Jl. Contoh No.123, Purwokerto" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="add-jam"><i class="fas fa-clock"></i> Jam Operasional</label>
                                <input type="text" id="add-jam" placeholder="08:00 - 21:00">
                            </div>
                            <div class="form-group">
                                <label for="add-harga"><i class="fas fa-money-bill"></i> Kisaran Harga</label>
                                <input type="text" id="add-harga" placeholder="Rp15.000-Rp25.000">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="add-deskripsi"><i class="fas fa-align-left"></i> Deskripsi</label>
                            <textarea id="add-deskripsi" placeholder="Deskripsi singkat tentang kuliner..."></textarea>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="add-foto"><i class="fas fa-image"></i> URL Foto</label>
                                <input type="url" id="add-foto" placeholder="https://example.com/foto.jpg">
                            </div>
                            <div class="form-group">
                                <label for="add-kontak"><i class="fas fa-phone"></i> Nomor Kontak</label>
                                <input type="tel" id="add-kontak" placeholder="08123456789">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="add-lat"><i class="fas fa-map-pin"></i> Latitude *</label>
                                <input type="number" step="any" id="add-lat" placeholder="-7.4212" required>
                            </div>
                            <div class="form-group">
                                <label for="add-lng"><i class="fas fa-map-pin"></i> Longitude *</label>
                                <input type="number" step="any" id="add-lng" placeholder="109.2422" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="add-tipe"><i class="fas fa-store-alt"></i> Tipe Penjual</label>
                                <select id="add-tipe">
                                    <option value="false">üè† Warung/Toko Tetap</option>
                                    <option value="true">üöö Pedagang Keliling</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="add-halal"><i class="fas fa-certificate"></i> Status Halal</label>
                                <select id="add-halal">
                                    <option value="unknown">‚ùì Belum Diketahui</option>
                                    <option value="halal">‚úÖ Halal MUI</option>
                                    <option value="halal-self">üïå Halal (Self-Declared)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="add-parkir"><i class="fas fa-parking"></i> Fasilitas Parkir</label>
                            <input type="text" id="add-parkir" placeholder="Tersedia, luas">
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeAddKulinerModal()">Batal</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> Kirim
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Auth Modal -->
        <div class="modal" id="authModal">
            <div class="modal-content auth-modal-content">
                <button class="modal-close" onclick="closeAuthModal()" aria-label="Tutup">
                    <i class="fas fa-times"></i>
                </button>
                <div class="auth-container">
                    <div class="auth-header">
                        <span class="auth-logo">üçΩÔ∏è</span>
                        <h2>Masuk ke Lapor Mangan!</h2>
                        <p>Nikmati fitur lengkap untuk pengalaman kuliner terbaik</p>
                    </div>
                    <div class="auth-benefits">
                        <div class="benefit-item">
                            <i class="fas fa-heart"></i>
                            <span>Simpan kuliner favorit</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-star"></i>
                            <span>Tulis ulasan & rating</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-plus-circle"></i>
                            <span>Kontribusi kuliner baru</span>
                        </div>
                    </div>
                    <div class="auth-buttons">
                        <button class="btn btn-google" onclick="signInWithGoogle()">
                            <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                            Masuk dengan Google
                        </button>
                    </div>
                    <div class="auth-footer">
                        <p>Dengan masuk, Anda menyetujui <a href="#">Ketentuan Layanan</a> dan <a href="#">Kebijakan Privasi</a> kami</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Dropdown Menu -->
        <div class="dropdown-menu" id="userDropdownMenu">
            <div class="dropdown-header">
                <img src="" alt="User" id="dropdownAvatar" class="dropdown-avatar">
                <div class="dropdown-user-info">
                    <span class="dropdown-name" id="dropdownName">User</span>
                    <span class="dropdown-email" id="dropdownEmail">user@email.com</span>
                </div>
            </div>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item" onclick="showSection('favorites')">
                <i class="fas fa-heart"></i> Favorit Saya
            </a>
            <a href="#" class="dropdown-item" onclick="showMyReviews()">
                <i class="fas fa-star"></i> Ulasan Saya
            </a>
            <a href="#" class="dropdown-item" onclick="showMyContributions()">
                <i class="fas fa-plus-circle"></i> Kontribusi Saya
            </a>
            <div class="dropdown-divider"></div>
            <a href="#" class="dropdown-item" onclick="openSettings()">
                <i class="fas fa-cog"></i> Pengaturan
            </a>
            <a href="#" class="dropdown-item text-danger" onclick="signOut()">
                <i class="fas fa-sign-out-alt"></i> Keluar
            </a>
        </div>

        <!-- Chatbot -->
        <button class="chatbot-toggle" onclick="toggleChat()" aria-label="Buka Chatbot">
            <i class="fas fa-robot"></i>
            <span class="chatbot-badge">1</span>
        </button>

        <div class="chat-popup" id="chatPopup">
            <div class="chat-header">
                <div class="chat-header-info">
                    <div class="chat-avatar">ü§ñ</div>
                    <div>
                        <h3>MakanBot</h3>
                        <span class="chat-status">Online</span>
                    </div>
                </div>
                <button class="chat-close" onclick="toggleChat()" aria-label="Tutup Chat">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message message-bot">
                    <div class="message-content">
                        Halo! üëã Aku <strong>MakanBot</strong>, asisten kulinermu di Purwokerto!<br><br>
                        Mau cari makan apa hari ini? Tanyakan saja, aku siap membantu! üòä
                    </div>
                </div>
            </div>
            <div class="chat-suggestions">
                <button class="suggestion-chip" onclick="sendSuggestion('Rekomendasi makanan pedas')">üå∂Ô∏è Makanan Pedas</button>
                <button class="suggestion-chip" onclick="sendSuggestion('Kuliner murah')">üí∞ Murah Meriah</button>
                <button class="suggestion-chip" onclick="sendSuggestion('Buka malam')">üåô Buka Malam</button>
            </div>
            <div class="chat-input-container">
                <input type="text" id="chatInput" placeholder="Ketik pesan..." aria-label="Pesan chat">
                <button class="chat-send" onclick="sendChat()" aria-label="Kirim">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="bottom-nav">
            <a href="#" class="nav-item active" onclick="showSection('home')">
                <i class="fas fa-home"></i>
                <span>Beranda</span>
            </a>
            <a href="#" class="nav-item" onclick="showSection('explore')">
                <i class="fas fa-compass"></i>
                <span>Jelajahi</span>
            </a>
            <a href="#" class="nav-item" onclick="showSection('map')">
                <i class="fas fa-map"></i>
                <span>Peta</span>
            </a>
            <a href="#" class="nav-item" onclick="showSection('favorites')">
                <i class="fas fa-heart"></i>
                <span>Favorit</span>
            </a>
            <a href="#" class="nav-item" onclick="toggleChat()">
                <i class="fas fa-robot"></i>
                <span>MakanBot</span>
            </a>
        </nav>
    </div>

    <!-- Toast Notification -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
        <!-- Firebase SDK -->
        <script type="module">
            // TODO: Ganti config berikut dengan config Firebase project Anda
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
            import { getAuth, signInWithPopup, GoogleAuthProvider, signOut as fbSignOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
            const firebaseConfig = {
                apiKey: "YOUR_API_KEY",
                authDomain: "YOUR_AUTH_DOMAIN",
                projectId: "YOUR_PROJECT_ID",
                storageBucket: "YOUR_STORAGE_BUCKET",
                messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
                appId: "YOUR_APP_ID"
            };
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            window.firebaseAuth = auth;
            window.GoogleAuthProvider = GoogleAuthProvider;
            window.signInWithPopup = signInWithPopup;
            window.fbSignOut = fbSignOut;
            window.onAuthStateChanged = onAuthStateChanged;
        </script>
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
        <script src="knowledge-base.js"></script>
        <!-- <script src="script.js"></script> -->
        <script src="app-complete.js"></script>
        <script src="features-additional.js"></script>
        <script src="chatbot.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }
    </script>
</body>
</html>
